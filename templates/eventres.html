{% extends "index.html" %}

{% comment %}
This template shows the results for an event. (Not the event overview page.) It's called from
ratings.views.events.
{% endcomment %}

{% load ratings_extras %}

{% block title %}{{ event }}{% endblock %}

{% block content %}
    <h2>{{ event }}</h2>

	<form method="post" action="/results/events/{{ event.id }}/">
    {% csrf_token %}
    <div class="ibox" style="margin-left: 2em;">
        <div class="iboxh">Details{% if adm %} (<a href="#" onclick="toggle_infobox(); return false;">Edit</a>){% endif %}</div>
        <div class="iboxtable">
            <div class="row edit" style="display: none;">
                <div class="rowel" style="width: 7em;"><big><strong>Note</strong></big></div>
                <div class="rower" style="width: 18em;"><big>Date, Game and On-/Offline will apply to <strong>ALL</strong> subevents!</big>
                </div>
            </div>
            <div class="row infobox">
                <div class="rowel" style="width: 7em;">Date{% ifnotequal earliest latest %}s{% endifnotequal %}</div>
                <div class="rower" style="width: 18em;">
                    {% if earliest and latest %}
	                	{% ifequal earliest latest %}
                		{{ earliest }}
                		{% else %}
	                    {{ earliest }} to {{ latest }}
                		{% endifequal %}
                    {% endif %}
                </div>
            </div>
            {% if adm %}
                <div class="row edit" style="display: none;">
                	<div class="rowel">Name</div>
                	<div class="rower">
                		<input type="text" name="name" id="name"
							{% for e in path %}
                	    		{% if forloop.last %}
	        						value="{{ e.name }}"
        						{% endif %}
					    	{% endfor %}
                		/>
                	</div>
                </div>
                <div class="row edit" style="display: none;">
                <div class="rowel">Date</div>
                <div class="rower"><input type="text" name="date" class="date" id="date"
                                    value="No change" />
                    <script type="text/javascript" src="/js/datepicker.js" /></script>
                    <script type="text/javascript">
                        // <![CDATA[  
                        var opts = {                            
                        formElements:{"date":"Y-ds-m-ds-d"},
                            statusFormat:"l-cc-sp-d-sp-F-sp-Y", 
                        };           
                        datePickerController.createDatePicker(opts);
                        // ]]>
                    </script></div>
                </div>
            {% endif %}
            {% if game %}
            <div class="row infobox">
                <div class="rowel">Game</div>
                <div class="rower">{{ game }}</div>
            </div>
            {% endif %}
            {% if adm %}
                <div class="row edit" style="display: none;">
                	<div class="rowel">Game</div>
                	<div class="rower">
                	<select name="game" id="game">
                        <option value="nochange" {% if not game %}selected{% endif %}>No change</option>
                        <option value="WoL" {% if game == "Wings of Liberty" %}selected{% endif %}>Wings of Liberty</option>
                        <option value="HotS" {% if game == "Heart of the Swarm" %}selected{% endif %}>Heart of the Swarm</option>
                    </select>
                	</div>
                </div>
            {% endif %}
            <div class="row infobox">
                <div class="rowel">On-/Offline</div>
                <div class="rower">{{ offline|yesno:"Offline,Online,Both" }}</div>
            </div>
            {% if adm %}
                <div class="row edit" style="display: none;">
                	<div class="rowel">On-/Offline</div>
                	<div class="rower">
                    <select name="offline" id="offline">
                        <option value="nochange" {% if offline == None %}selected{% endif %}>No change</option>
                        <option value="online" {% if offline != None %}selected{% endif %}>Online</option>
                        <option value="offline" {% if offline %}selected{% endif %}>Offline</option>
                    </select>
                	</div>
                </div>
            {% endif %}
            {% if adm %}
                {% if eventtype %}
                <div class="row infobox">
                    <div class="rowel">Type</div>
                    <div class="rower">{{ eventtype|capfirst }}</div>
                </div>
                {% endif %}
                <div class="row edit" style="display: none;">
                	<div class="rowel">Type</div>
                	<div class="rower">
                    <select name="type" id="type">
                        <option value="nochange" {% if not eventtype %}selected{% endif %}>No change</option>
                        <option value="category" {% if eventtype == "category" %}selected{% endif %}/>Category</option>
                        <option value="event" {% if eventtype == "event" %}selected{% endif %}/>Event</option>
                        <option value="round" {% if eventtype == "round" %}selected{% endif %}/>Round</option>
                    </select>
                	</div>
                </div>
                <div class="row edit" style="display: none;">
                	<div class="rowel">
                	<input type="checkbox" id="siblings" name="siblings" value="siblings" />
                	</div>
                	<div class="rower">
                    <label for="siblings">Apply to events on the same level</label>
                	</div>
                </div>
            {% endif %}
            <div class="row">
                <div class="rowel">Games</div>
                <div class="rower">{{ ngames }}</div>
            </div>
            <div class="row">
                <div class="rowel">Matches</div>
                <div class="rower">{{ nmatches }}</div>
            </div>
            <div class="row">
                <div class="rowel">PvT</div>
                <div class="rower">
                    {{ pvt_wins }}–{{ pvt_loss }} ({{ pvt_wins|pctg:pvt_loss }}%)
                </div>
            </div>
            <div class="row">
                <div class="rowel">PvZ</div>
                <div class="rower">
                    {{ pvz_wins }}–{{ pvz_loss }} ({{ pvz_wins|pctg:pvz_loss }}%)
                </div>
            </div>
            <div class="row">
                <div class="rowel">TvZ</div>
                <div class="rower">
                    {{ tvz_wins }}–{{ tvz_loss }} ({{ tvz_wins|pctg:tvz_loss }}%)
                </div>
            </div>
            {% if homepage or lp_name %}
            <div class="row infobox">
                <div class="rowel">External</div>
                <div class="rower">
					{% if homepage %}
                    <a href="{{ event.get_homepage }}" target="_blank">Homepage</a>
                    {% endif %}
					{% if lp_name %}
                    <a href="http://wiki.teamliquid.net/starcraft2/{{ lp_name }}" target="_blank">LP</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% if adm %}
				<div class="row edit" style="display: none;">
	            	<div class="rowel">Homepage</div>
                	<div class="rower"><input type="text" name="homepage" {% if homepage %}value="{{ homepage }}"{% endif %} /></div>
				</div>
				<div class="row edit" style="display: none;">
	            	<div class="rowel">Liquipedia</div>
                	<div class="rower"><input type="text" name="lp_name" {% if lp_name %}value="{{ lp_name }}"{% endif %} /></div>
				</div>
				<div class="row edit" style="display: none;">
	            	<div class="rowel"></div>
                	<div class="rower"><input type="submit" name="op" value="Modify" /></div>
				</div>
			{% endif %}
        </div>
    </div>
    </form>

    <p><a href="/results/events/">Root</a> →
    {% for e in path %}
        {% if forloop.last %}{{ e.name }}{% else %}
        <a href="/results/events/{{ e.id }}-{{ e.fullname|urlfilter }}/">{{ e.name }}</a> →{% endif %}
    {% endfor %}
    {% if adm %}
        [<a href="/admin/ratings/event/{{ event.id }}/">admin</a>]
    {% endif %}

    {% if children or siblings %}
    <div class="table" style="width: 35em;">

    {% if siblings %}
    <div class="row">
        <div class="rowel" style="width: 7em;">Same level:</div>
        <div class="rower" style="width: 28em;">
        {% if siblings.count > 9 %}
            <form method="get" action="/results/events/">
            <select name="goto">
                {% for e in siblings %}
                <option value="{{ e.id }}">{{ e.name }}</option>
                {% endfor %}
            </select>
            <input type="submit" value="Go" />
            </form>
        {% else %}
        {% for e in siblings %}
            <a href="/results/events/{{ e.id }}-{{ e.fullname|urlfilter }}/">{{ e.name }}</a>{% if not forloop.last %}, {% endif %}
        {% endfor %}
        {% endif %}
        </div>
    </div>
    {% endif %}

    {% if children %}
    <div class="row">
        <div class="rowel">Next level:</div>
        <div class="rower">
        {% if children.count > 9 %}
            <form method="get" action="/results/events/">
            <select name="goto">
                {% for e in children %}
                <option value="{{ e.id }}">{{ e.name }}</option>
                {% endfor %}
            </select>
            <input type="submit" value="Go" />
            </form>
        {% else %}
        {% for e in children %}
            <a href="/results/events/{{ e.id }}-{{ e.fullname|urlfilter }}/">{{ e.name }}</a>{% if not forloop.last %}, {% endif %}
        {% endfor %}
        {% endif %}
        </div>
    </div>
    {% endif %}

    </div>
    {% endif %}

    {% if event.closed %}
        <p>This event is <strong>closed</strong>. No more games will be added.</p>
    {% else %}
        <p>This event is still <strong>open</strong>. Games may be added.</p>
    {% endif %}
    
    {% if event.big %}
        <p>This event is <strong>big</strong>, so the list of games has been cut-off. Go to an event on the next
        level to see a complete list.</p>
    {% endif %}
    
    {% if message %}
        {{ message }}
    {% endif %}

    {% if matches %}
        <table class="results">
        {% include "matchlist.html" with lm_list=matches lm_adm=0 lm_header="full" %}
        </table>
    {% else %}
        <p>This event has no registered games... yet.</p>
    {% endif %}

    {% if adm %}
        <p>Add subevent:</p>
        <form method="post" action="/results/events/{{ event.id }}/">
        {% csrf_token %}
        
        <input type="hidden" name="parent" value="{{ event }}" />
        <table class="bigform">
            <tr>
                <td class="form_left">
                    <label for="subevent">Event name</label>
                </td>
                <td class="form_right">
                    <label for="subevent">{{ event }} </label><input type="text" name="subevent" id="subevent" />
                </td>
            </tr>
            <tr>
                <td class="form_left">
                    Type
                </td>
                <td class="form_right">
                    <input type="radio" id="category" name="type" value="category"/>
                    <label for="category">Category</label>
                    <input type="radio" id="event" name="type" value="event" {% if event.type == 'category' %}checked{% endif %}/>
                    <label for="event">Event</label>
                    <input type="radio" id="round" name="type" value="round" {% if event.type == 'event' or event.type == 'round' %}checked{% endif %}/>
                    <label for="round">Round</label>
                </td>
            </tr>
            <tr>
                <td class="form_left">
                </td>
                <td class="form_right">
                    <input type="checkbox" id="noprint" name="noprint" value="noprint"/>
                    <label for="noprint">No Print</label>
                    <input type="checkbox" id="closed" name="closed" value="closed" checked/>
                    <label for="closed">Closed</label>
                </td>
            </tr>                                
            <tr>
                <td class="form_left"></td>
                <td class="form_right">
                    <input type="Submit" name="add" value="Add" />
                </td>
            </tr>
        	<form method="post" action="/results/events/{{ event.id }}/">
	        {% csrf_token %}
			<tr>
				<td class="form_left">
					<label for="moveevent">Move this event</label>
				</td>
				<td class="form_right">
                    <select name="moveevent" id="moveevent">
                    	{% for events in surroundingevents %} 
                        <option value="{{ events.id }}" {% ifequal events event %}selected{% endifequal %}>{{ events }}</option>
                        {% endfor %}
                    </select>
				</td>
			</tr>                                
            <tr>
                <td class="form_left"></td>
                <td class="form_right">
                    <input type="Submit" name="move" value="Move" />
                </td>
            </tr>
        </table>
        </form>
    {% endif %}

<p>Notice something missing? We're always looking for people to help <a href="/add/">populate our database</a>!</p>
{% endblock %}
