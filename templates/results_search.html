{% extends "index.html" %}

{% load ratings_extras %}

{% block title %}Search{% endblock %}

{% block content %}
    <h2>Search results</h2>

    {% if errs %}
    <p>Please fix the following problems:</p>
    <ul>
        {% for e in errs %}
        <li>{{ e }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if message %}
    <p><strong>{{ message }}</strong></p>
    {% endif %}

    <form method="get" action="/results/search/">
        <input type="hidden" name="op" value="search" />
    <div class="table" style="width: 50em;">
        <div class="row">
            <div class="rowel" style="width: 15em;">Date</div>
            <div class="rower" style="width: 35em;">
                between <input type="text" name="after" id="after" style="width: 6.5em;" value="{{ after }}" />
                and <input type="text" name="before" id="before" style="width: 6.5em;" value="{{ before }}" />
                inclusive
                <script type="text/javascript" src="/js/datepicker.js" /></script>
                <script type="text/javascript">
                    // <![CDATA[  
                    var opts = {                            
                        formElements:{"before":"Y-ds-m-ds-d"},
                        statusFormat:"l-cc-sp-d-sp-F-sp-Y", 
                    };
                    datePickerController.createDatePicker(opts);
                    var opts2 = {                            
                        formElements:{"after":"Y-ds-m-ds-d"},
                        statusFormat:"l-cc-sp-d-sp-F-sp-Y", 
                    };
                    datePickerController.createDatePicker(opts2);
                    // ]]>
                </script>
            </div>
        </div>
        <div class="row">
            <div class="rowel" style="vertical-align: top;">Involving players</div>
            <div class="rower">
                <textarea name="players" rows="6" style="width: 35em;">{{Â pls }}</textarea>
            </div>
        </div>
        {% if adm %}
        <div class="row">
            <div class="rowel">Event text</div>
            <div class="rower">
                <input type="text" name="eventtext" style="width: 35em;" value="{{ eventtext }}"/>
            </div>
        </div>
        <div class="row">
            <div class="rowel"></div>
            <div class="rower">
                <input type="checkbox" name="unassigned" id="unassigned" value="yes" {% if unassigned %}checked{% endif %} />
                <label for="unassigned">Only show unassigned matches</label>
            </div>
        </div>
        {% endif %}
        <div class="row">
            <div class="rowel"></div>
            <div class="rower">
                <input type="submit" value="Search" />
            </div>
        </div>
    </div>
    </form>

    {% if not matches %}
    <p>Enter one player per line. The player information must uniquely identify the player, and should be space-separated list
    of any of the following:</p>

    <ul>
        <li>Player tag, e.g. &quot;DongRaeGu&quot;</li>
        <li>Race, i.e. &quot;P&quot;, &quot;T&quot;, &quot;Z&quot;, &quot;R&quot; or &quot;S&quot;</li>
        <li>A two-letter <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 3166-1 alpha-2</a> country code. e.g. &quot;KR&quot;</li>
        <li>A player ID number, which you can get from the URL of the player page, e.g. &quot;4&quot;</li>
    </ul>

    <p>Most players can be uniquely identified through their player tag alone. In the cases where they cannot, race and country should
    suffice. Some problematic players include the two Korean Protoss players Hero and the Zergs Shine. In these cases, you must search and
    pick out the player ID. (Yes, I know this is awkward.)</p>

    <p>Note that everything is case insensitive.</p>
    {% else %}

    <p>Found {{ count }} matches.</p>

    {% if adm %}
        <form method="post"
            action="/results/search/?op=search&amp;after={{after}}&amp;before={{before}}&amp;players={{pls|urlencode}}&amp;eventtext={{eventtext|urlencode}}&amp;unassigned={{unassigned_get}}">
        {% csrf_token %}
    {% endif %}

    {% for m in matches %}
        {% include "list_matches.html" with lm_list=m lm_show_date=1 lm_adm=adm lm_header_event=1 %}
    {% endfor %}

    {% if adm %}
    <script type="text/javascript">
    <!--
    function mark_all(val)
    {
        var list = document.getElementsByTagName("input");
        for (var i = 0; i < list.length; i++)
            if (list[i].getAttribute("type") == "checkbox")
                list[i].checked = val;
    }
    //-->
    </script>

    <p><span style="color: #ff0000;"><strong>CAREFUL:</strong></span>
    To all checked matches, assign event object:</p>
    <select name="event">
        {% for event in events %}
        <option value="{{ event.id }}">{{ event }}</option>
        {% endfor %}
    </select>
    <input type="Submit" name="op" value="Assign" /></form>
    <p>
        <input type="button" onclick="mark_all(true);" value="Check all" />
        <input type="button" onclick="mark_all(false);" value="Uncheck all" />
    </p>
    {% endif %}

    {% endif %}
{% endblock %}
