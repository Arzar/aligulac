{% load ratings_extras %}

<script type="text/javascript">
<!--
function lm_toggle(id)
{
    var d = document.getElementById('lm-' + id);
    if (d.style.display == 'none')
    {
        d.style.display = 'table-row-group';
        document.getElementById('lma-' + id).innerHTML = 'hide';
    }
    else
    {
        d.style.display = 'none';
        document.getElementById('lma-' + id).innerHTML = 'show';
    }
}
//-->
</script>

{% if lm_header_event %}
<tr class="header">
    <td colspan="6">
        {% if lm_list.0.eventobj %} ▸
            {% for p in lm_list.0.eventobj.get_path %}
            <a href="/results/events/{{ p.id }}/">{{ p.name }}</a>
            {% endfor %}
        {% elif lm_list.0.event %}
            {{ lm_list.0.event }}
        {% else %}
            Unknown event(s)
        {% endif %}
    </td>
    <td class="lm_right">
        <a id="lma-{{ lm_list.0.id }}" href="#" onclick="lm_toggle('{{ lm_list.0.id }}'); return false;">hide</a>
    </td>
</tr>
{% endif %}

{% if lm_header_info %}
    <tr class="header">
        <td class="lm_date">{% if lm_show_date %}Date{% endif %}</td>
        <td class="lm_rta">{% if lm_sorted %}Rating{% endif %}</td>
        <td class="lm_pla">{% if not lm_sorted %}Player A{% endif %}</td>
        <td class="lm_score">Score</td>
        <td class="lm_plb">{% if lm_sorted %}Opponent{% else %}Player B{% endif %}</td>
        <td class="lm_rtb">{% if lm_sorted %}Rating{% endif %}</td>
        <td class="lm_right"></td>
    </tr>
{% endif %}
{% if lm_header_event %} <tbody id="lm-{{ lm_list.0.id }}"> {% endif %}
    {% for m in lm_list %}
    <tr class="{% cycle 'row2' 'row1' %}" {% if lm_header_info %}
                                              {% if m.eventobj %}title="{{ m.eventobj }}"
                                              {% elif m.event %}title="{{ m.event }}"
                                              {% else %}title="Unknown event"{% endif %} {% endif %}>
        <td class="lm_date">
            {% if lm_show_date %}{{ m.date|date:"Y-m-d" }}{% endif %}
        </td>
        <td class="lm_rta">
            {% if lm_sorted %}
                {{ m.rt_my|ratscale }}
            {% endif %}
        </td>
        <td class="lm_pla">
            {% if lm_sorted %}
                {% if m.sc_my > m.sc_op %}<strong>{% endif %}
                <a href="/players/{{ lm_player.id }}/">{{ lm_player.tag }}</a>
                {% if lm_player.country != "" %}
                    <img src="http://aligulac.com:81/al/flags/{{ lm_player.country|lower }}.png" alt="{{ lm_player.country }}" />
                {% endif %}
                <img src="http://aligulac.com:81/al/{{ m.rc_my }}.png" alt="{{ m.rc_my }}" class="btm" />
                {% if m.sc_my > m.sc_op %}</strong>{% endif %}
            {% else %}
                {% if m.sca > m.scb %}<strong>{% endif %}
                <a href="/players/{{ m.pla.id }}/">{{ m.pla.tag }}</a>
                {% if m.pla.country != "" %}
                    <img src="http://aligulac.com:81/al/flags/{{ m.pla.country|lower }}.png" alt="{{ m.pla.country }}" />
                {% endif %}
                <img src="http://aligulac.com:81/al/{{ m.rca }}.png" alt="{{ m.rca }}" class="btm" />
                {% if m.sca > m.scb %}</strong>{% endif %}
            {% endif %}
        </td>
        <<tdd class="lm_score">
            {% if lm_sorted %}
                {{ m.sc_my }}-{{ m.sc_op }}
            {% else %}
                {{ m.sca }}–{{ m.scb }}
            {% endif %}
        </td>
        <td class="lm_plb">
            {% if lm_sorted %}
                {% if m.sc_op > m.sc_my %}<strong>{% endif %}
                <img src="http://aligulac.com:81/al/{{ m.rc_op }}.png" alt="{{ m.rc_op }}" class="btm" />
                {% if m.plb.country != "" %}
                    <img src="http://aligulac.com:81/al/flags/{{ m.opp.country|lower }}.png" alt="{{ m.opp.country }}" />
                {% endif %}
                <a href="/players/{{ m.opp.id }}/">{{ m.opp.tag }}</a>
                {% if m.sc_op > m.sc_my %}</strong>{% endif %}
            {% else %}
                {% if m.scb > m.sca %}<strong>{% endif %}
                <img src="http://aligulac.com:81/al/{{ m.rcb }}.png" alt="{{ m.rcb }}" class="btm" />
                {% if m.plb.country != "" %}
                    <img src="http://aligulac.com:81/al/flags/{{ m.plb.country|lower }}.png" alt="{{ m.plb.country }}" />
                {% endif %}
                <a href="/players/{{ m.plb.id }}/">{{ m.plb.tag }}</a>
                {% if m.scb > m.sca %}</strong>{% endif %}
            {% endif %}
        </td>
        <td class="lm_rtb">
            {% if lm_sorted %}
                {{ m.rt_op|ratscale }}
            {% endif %}
        </td>
        <td class="lm_right">
            {% if lm_adm %}
                {% if not lm_nocheck %}<input type="checkbox" name="match-{{ m.id }}" value="y" />{% endif %}
                <a href="/admin/ratings/match/{{ m.id }}/">→</a>
            {% else %}
                {% if m.treated %}
                    <img src="http://aligulac.com:81/al/yes.png" alt="yes" class="btm" />
                {% else %}
                    <img src="http://aligulac.com:81/al/no.png" alt="yes" class="btm" />
                {% endif %}
            {% endif %}
        </td>
    </tr>
    {% endfor %}
{% if lm_header_event %} </tbody> {% endif %}
